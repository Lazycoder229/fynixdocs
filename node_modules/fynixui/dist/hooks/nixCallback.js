import { activeContext } from "../context/context";
export function nixCallback(fn, deps = []) {
    const ctx = activeContext;
    if (!ctx)
        throw new Error("nixCallback() called outside component");
    if (typeof fn !== "function") {
        console.error("[nixCallback] First argument must be a function");
        return fn;
    }
    if (!Array.isArray(deps)) {
        console.error("[nixCallback] Second argument must be an array");
        deps = [];
    }
    const MAX_DEPS = 100;
    if (deps.length > MAX_DEPS) {
        console.warn(`[nixCallback] Dependency array too large (${deps.length}). Limited to ${MAX_DEPS}.`);
        deps = deps.slice(0, MAX_DEPS);
    }
    const idx = ctx.hookIndex++;
    const prev = ctx.hooks[idx];
    if (!prev || !shallowArrayEqual(prev.deps, deps)) {
        ctx.hooks[idx] = { value: fn, deps };
    }
    return ctx.hooks[idx].value;
}
function shallowArrayEqual(a, b) {
    if (a.length !== b.length)
        return false;
    for (let i = 0; i < a.length; i++) {
        if (!Object.is(a[i], b[i]))
            return false;
    }
    return true;
}
