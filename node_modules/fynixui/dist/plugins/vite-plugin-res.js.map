{
  "version": 3,
  "sources": ["../../plugins/vite-plugin-res.ts"],
  "sourcesContent": ["import { transform, type TransformOptions } from \"esbuild\";\r\nimport type { HmrContext, ViteDevServer } from \"vite\";\r\nimport { normalizePath } from \"vite\";\r\n\r\n/**\r\n * Vite plugin options for Fynix\r\n */\r\ninterface FynixPluginOptions {\r\n  /**\r\n   * JSX factory function name\r\n   * @default \"Fynix\"\r\n   */\r\n  jsxFactory?: string;\r\n\r\n  /**\r\n   * JSX fragment factory name\r\n   * @default \"Fynix.Fragment\"\r\n   */\r\n  jsxFragment?: string;\r\n\r\n  /**\r\n   * File extensions to transform\r\n   * @default [\".ts\", \".js\", \".jsx\", \".tsx\", \".fnx\"]\r\n   */\r\n  include?: string[];\r\n\r\n  /**\r\n   * Paths to exclude from transformation\r\n   * @default [\"node_modules\"]\r\n   */\r\n  exclude?: string[];\r\n\r\n  /**\r\n   * Enable source maps\r\n   * @default true\r\n   */\r\n  sourcemap?: boolean;\r\n\r\n  /**\r\n   * Custom esbuild transform options\r\n   */\r\n  esbuildOptions?: Partial<TransformOptions>;\r\n}\r\n\r\n/**\r\n * Extended context type that includes Vite's transform context methods\r\n */\r\ninterface TransformContext {\r\n  addWatchFile?: (id: string) => void;\r\n}\r\n\r\n/**\r\n * Vite plugin for Fynix framework\r\n * Transforms JSX/TSX files using esbuild with custom JSX pragma\r\n */\r\nexport default function fynixPlugin(options: FynixPluginOptions = {}) {\r\n  const {\r\n    jsxFactory = \"Fynix\",\r\n    jsxFragment = \"Fynix.Fragment\",\r\n    include = [\".ts\", \".js\", \".jsx\", \".tsx\", \".fnx\"],\r\n    exclude = [\"node_modules\"],\r\n    sourcemap = true,\r\n    esbuildOptions = {},\r\n  } = options;\r\n\r\n  let viteServer: ViteDevServer | null = null;\r\n\r\n  return {\r\n    name: \"vite-plugin-fynix\",\r\n    enforce: \"pre\" as const,\r\n\r\n    /**\r\n     * Capture the Vite dev server instance for sending\r\n     * WebSocket messages (error overlays, reloads, etc.)\r\n     */\r\n    configureServer(server: ViteDevServer) {\r\n      viteServer = server;\r\n    },\r\n\r\n    async transform(code: string, id: string) {\r\n      const normalizedId = normalizePath(id);\r\n      const shouldExclude = exclude.some((pattern) =>\r\n        normalizedId.includes(pattern)\r\n      );\r\n      if (shouldExclude) return null;\r\n      const shouldInclude = include.some((ext) => normalizedId.endsWith(ext));\r\n      if (!shouldInclude) return null;\r\n\r\n      // Type-safe way to access Vite context methods\r\n      const ctx = this as unknown as TransformContext;\r\n      if (typeof ctx.addWatchFile === \"function\") {\r\n        ctx.addWatchFile(id);\r\n      }\r\n\r\n      try {\r\n        let loader: TransformOptions[\"loader\"] = \"tsx\";\r\n        if (normalizedId.endsWith(\".ts\") || normalizedId.endsWith(\".fnx\")) {\r\n          loader = \"tsx\";\r\n        } else if (normalizedId.endsWith(\".tsx\")) {\r\n          loader = \"tsx\";\r\n        } else if (normalizedId.endsWith(\".jsx\")) {\r\n          loader = \"jsx\";\r\n        } else if (normalizedId.endsWith(\".js\")) {\r\n          loader = \"jsx\";\r\n        }\r\n\r\n        const result = await transform(code, {\r\n          loader,\r\n          jsxFactory,\r\n          jsxFragment,\r\n          sourcemap,\r\n          sourcefile: id,\r\n          target: \"esnext\",\r\n          format: \"esm\",\r\n          ...esbuildOptions,\r\n        });\r\n\r\n        return {\r\n          code: result.code,\r\n          map: result.map || null,\r\n        };\r\n      } catch (error) {\r\n        const err = error as Error;\r\n\r\n        // Send error overlay to the browser via WebSocket\r\n        // This shows the red error overlay in the browser instead of just logging to terminal\r\n        if (viteServer) {\r\n          viteServer.ws.send({\r\n            type: \"error\",\r\n            err: {\r\n              message: err.message,\r\n              stack: err.stack || \"\",\r\n              plugin: \"vite-plugin-fynix\",\r\n              id,\r\n            },\r\n          });\r\n        }\r\n\r\n        // Log to terminal as well\r\n        console.error(`\\x1b[32m[vite-plugin-fynix]\\x1b[0m \\x1b[31mFailed to transform ${id}:\\x1b[0m`);\r\n        console.error(err.message);\r\n\r\n        // Return null instead of throwing so Vite's HMR pipeline\r\n        // stays intact and can recover when the error is fixed\r\n        return null;\r\n      }\r\n    },\r\n\r\n    handleHotUpdate(ctx: HmrContext) {\r\n      const { file, server } = ctx;\r\n      const normalizedFile = normalizePath(file);\r\n      const shouldReload = include.some((ext) => normalizedFile.endsWith(ext));\r\n\r\n      if (shouldReload) {\r\n        console.log(\r\n          `\\x1b[32m[vite-plugin-fynix]\\x1b[0m HMR: full-reload triggered by ${normalizedFile}`\r\n        );\r\n        server.ws.send({\r\n          type: \"full-reload\",\r\n          path: \"*\",\r\n        });\r\n        return [];\r\n      }\r\n\r\n      return undefined;\r\n    },\r\n\r\n    config() {\r\n      return {\r\n        esbuild: false as const,\r\n        optimizeDeps: {\r\n          include: [\"fynixui\"],\r\n          esbuildOptions: {\r\n            jsx: \"transform\",\r\n            jsxFactory,\r\n            jsxFragment,\r\n          },\r\n        },\r\n        resolve: {\r\n          extensions: [\".fnx\", \".ts\", \".tsx\", \".js\", \".jsx\", \".json\"],\r\n        },\r\n      };\r\n    },\r\n\r\n    buildStart() {\r\n      console.log(\r\n        `\\x1b[32m[vite-plugin-fynix]\\x1b[0m Initialized with JSX factory: ${jsxFactory}`\r\n      );\r\n    },\r\n  };\r\n}\r\n\r\n/**\r\n * Named export for convenience\r\n */\r\nexport { fynixPlugin };\r\n\r\n/**\r\n * Export types for TypeScript users\r\n */\r\nexport type { FynixPluginOptions };\r\n"],
  "mappings": "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",
  "names": []
}
